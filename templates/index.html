<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Copo de Koch - API</title>

<style>

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  color: #2c3e50;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;

  /* Imagen de fondo */
  background: url("https://previews.123rf.com/images/zagory/zagory1706/zagory170600106/80441201-seamless-background-with-formulas-and-charts-on-the-topic-of-mathematics-and-education-a-grey.jpg") no-repeat center center fixed;
  background-size: cover;
  position: relative;
}

/* Capa translúcida encima de la imagen */
body::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(163, 186, 210, 0.7); 
  z-index: -1; 
}


/* --- HEADER --- */
h1 {
  margin: 20px 0 10px 0;
  font-size: 3rem;
  color: #436280;
  text-align: center;
  text-shadow: 0 0 8px #a3bad2;
}

/* --- FILA SUPERIOR --- */
.top-layout {
  display: grid;
  grid-template-columns: 1fr 250px;
  gap: 20px;
  max-width: 1000px;
  margin: 20px auto;
  padding: 0 20px;
}

.desc-card {
  background: #fff;
  color: #000;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.image-card {
  background: #a3bad2;
  border-radius: 12px;
  padding: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
}

.image-card img {
  max-width: 100%;
  border-radius: 8px;
}

/* --- FILA CENTRAL --- */
.main-layout {
  display: grid;
  grid-template-columns: 250px 1fr;
  gap: 20px;
  max-width: 1000px;
  margin: 30px auto;
  padding: 0 20px;
}

/* --- FORMULARIO --- */
.controls {
  padding: 15px;
  background: #a3bad2;
  color: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.25);
  font-size: 0.9rem;
}

.controls label {
  display: block;
  margin: 10px 0 4px;
  font-weight: bold;
}

.controls input,
.controls select {
  width: 100%;
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  outline: none;
  margin-bottom: 10px;
  background: #fff;
  color: #000;
}

.controls button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border: none;
  border-radius: 8px;
  background: #436280;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

.controls button:hover {
  background: #2d4359;
}

.controls input,
.controls select {
  width: 100%;       
  max-width: 100%;   
  box-sizing: border-box; 
}
.controls input[type="range"] {
  width: 100%;   
}


/* --- CANVAS --- */
.canvas-container {
  background: #fff;
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
}

canvas {
  display: block;
  margin: auto;
  background: #000;
  border-radius: 10px;
  box-shadow: 0 0 15px #436280;
}

/* --- RESPONSIVIDAD --- */
@media (max-width: 900px) {
  .top-layout, .main-layout {
    grid-template-columns: 1fr;
  }

  .image-card, .controls {
    width: 100%;
  }
}


/* --- Animaciones del título --- */
h1 {
  animation: fadeInDown 1.2s ease-in-out;
  transition: transform 0.3s ease;
}
h1:hover {
  transform: scale(1.05);
  text-shadow: 0 0 12px #a3bad2, 0 0 20px #436280;
}

/* --- Tarjetas con hover --- */
.desc-card, .image-card, .controls, .canvas-container {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.desc-card:hover, .image-card:hover, .controls:hover, .canvas-container:hover {
  transform: translateY(-5px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.3);
}

/* --- Imagen con efecto suave --- */
.image-card img {
  max-width: 100%;
  border-radius: 8px;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}
.image-card img:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(67,98,128,0.6);
}

/* --- Keyframes para entrada elegante --- */
@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-40px); }
  to { opacity: 1; transform: translateY(0); }
}


  </style>
  
</head>
<body>
    <!-- Título -->
    <h1>Copo de Nieve de Koch</h1>
  
    <!-- Fila superior -->
    <div class="top-layout">
      <div class="desc-card">
        <h2>Copo de Koch</h2>
<p>
El <strong>copo de Koch</strong> es un <em>fractal</em> creado por Helge von Koch en 1904, que se forma a partir de un triángulo equilátero y genera un patrón similar a un copo de nieve. Su característica principal es que su <strong>perímetro es infinito</strong> pero su <strong>área es finita</strong>.
</p>
<p>
Se construye <strong>iterativamente</strong>: cada segmento se divide en tres partes, se construye un triángulo equilátero sobre la parte central y se elimina su base. Esto se repite en cada segmento resultante.
</p>
<p>
<strong>Datos matemáticos:</strong><br>
- Número de segmentos en la iteración n: <em>N<sub>n</sub> = 4<sup>n</sup></em><br>
- Longitud de cada segmento: <em>L<sub>n</sub> = L<sub>0</sub> / 3<sup>n</sup></em><br>
- Perímetro total: <em>P<sub>n</sub> = L<sub>0</sub> (4/3)<sup>n</sup></em><br>
- Área total: <em>A = 9/5 A<sub>0</sub></em><br>
- Dimensión fractal: <em>D ≈ 1.2619</em>
</p>


      </div>
  
      <div class="image-card">
        <img src="https://mathsmattersresources.com/wp-content/uploads/Von-Koch-402x546.jpg" alt="Imagen extra">
      </div>
    </div>
  
    <!-- Fila central -->
    <div class="main-layout">
      <!-- Formulario -->
      <div class="controls">
        <label for="nivel">Nivel:</label>
        <input type="number" id="nivel" min="0" max="8" value="4">
  
        <label for="longitud">Longitud:</label>
        <input type="number" id="longitud" value="400">
  
        <label for="rapidez">Rapidez:</label>
        <input type="range" id="rapidez" min="1" max="20" value="5">
        <span id="rapidezVal">20</span>
  
        <label for="color">Color:</label>
        <input type="color" id="color" value="#436280">
  
        <button onclick="drawFractal()">Generar Copo</button>
        <button onclick="exportPNG()">Exportar PNG</button>
      </div>
  
      <!-- Canvas -->
      <div class="canvas-container">
        <canvas id="canvas" width="600" height="400"></canvas>
      </div>
    </div>

  
  <script>
    document.getElementById("rapidez").oninput = function() {
      document.getElementById("rapidezVal").textContent = this.value;
    };

    let animationTimeout; //  variable global para controlar la animación

    async function drawFractal() {
  const nivel = document.getElementById("nivel").value;
  const longitud = document.getElementById("longitud").value;
  const rapidez = document.getElementById("rapidez").value;
  const color = document.getElementById("color").value.substring(1);

  const res = await fetch(`/koch/${nivel}/${longitud}/${rapidez}/${color}`);
  const data = await res.json();
  const pts = data.points;
  const speed = data.rapidez;
  const strokeColor = data.color;

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.strokeStyle = strokeColor;
  ctx.shadowColor = strokeColor;
  ctx.shadowBlur = 15;
  ctx.lineWidth = 2;

  // Calcular el bounding box del fractal
  const xs = pts.map(p => p[0]);
  const ys = pts.map(p => p[1]);
  const minX = Math.min(...xs);
  const maxX = Math.max(...xs);
  const minY = Math.min(...ys);
  const maxY = Math.max(...ys);

  const fractalWidth = maxX - minX;
  const fractalHeight = maxY - minY;

  // Escalar automáticamente para que quepa en el canvas con un margen
  const margin = 40;
  const scaleX = (canvas.width - 2 * margin) / fractalWidth;
  const scaleY = (canvas.height - 2 * margin) / fractalHeight;
  const scale = Math.min(scaleX, scaleY);

  // Centrar el fractal en el canvas
  const offsetX = (canvas.width - fractalWidth * scale) / 2 - minX * scale;
  const offsetY = (canvas.height - fractalHeight * scale) / 2 + maxY * scale;

  let i = 0;
  function animate() {
  if (i < pts.length - 1) {
    const step = Math.max(1, Math.floor(speed / 10)); 
    for (let j = 0; j < step && i < pts.length - 1; j++, i++) {
      const [x1, y1] = pts[i];
      const [x2, y2] = pts[i + 1];
      ctx.beginPath();
      ctx.moveTo(x1 * scale + offsetX, offsetY - y1 * scale);
      ctx.lineTo(x2 * scale + offsetX, offsetY - y2 * scale);
      ctx.stroke();
    }
    animationTimeout = setTimeout(animate, 1000 / Math.min(speed, 60));
  }
}


  if (animationTimeout) {
    clearTimeout(animationTimeout);
  }

  animate();
}



    async function exportPNG() {
      const nivel = document.getElementById("nivel").value;
      const longitud = document.getElementById("longitud").value;
      const color = document.getElementById("color").value.substring(1);
      window.open(`/export/${nivel}/${longitud}/${color}`, "_blank");
    }

    // Inicial
    window.onload = drawFractal;
  </script>
</body>
</html>
